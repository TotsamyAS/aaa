{% extends "base.html" %}

{% block title %} ААА | Документы {% endblock %}

{% block content %}
    <div class="documents-page">
        <div class="page-header">
            <h1>Библиотека документов</h1>
            <div class="actions">
                <div class="search-container">
                    <input type="text" id="searchQuery" placeholder="Поиск документов...">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </div>
                <label class="upload-btn">
                    <input type="file" id="uploadFile" accept=".pdf" style="display:none">
                    <span>Загрузить</span>
                </label>
            </div>
        </div>

        <div class="documents-container">
            <div class="documents-grid" id="documents-grid">
                {% for doc in documents %}
                <div class="document-card">
                    <div class="doc-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                        </svg>
                    </div>
                    <div class="doc-info">
                        <h3>{{ doc.doc_name }}</h3>
                        <p>{{ doc.date_added }}</p>
                    </div>
                    <div class="doc-actions">
                        <button class="icon-btn delete" onclick="confirmDelete('{{ doc.doc_name }}')">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endblock %}

{% block modals %}
    <!-- Модальное окно подтверждения удаления -->
    <div id="deleteModal" class="modal-overlay" style="display: none;">
        <div class="modal">
            <div class="modal-header">
                <h3>Подтверждение удаления</h3>
                <button class="close-btn" onclick="closeDeleteModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <p>Вы уверены, что хотите удалить документ "<span id="documentNameToDelete"></span>"?</p>
            </div>
            <div class="modal-footer">
                <button class="secondary-btn" onclick="closeDeleteModal()">Отмена</button>
                <button class="primary-btn delete" onclick="deleteDocument()">Удалить</button>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        // Обработка загрузки файла
        document.getElementById('uploadFile').addEventListener('change', function(event) {
        const file = event.target.files[0];
        if (file && file.type === 'application/pdf') {
            const formData = new FormData();
            formData.append('file', file);

            fetch('/upload', {
                method: 'POST',
                body: formData,
            })
            .then(response => {
                if (response.ok) {
                    alert('Документ успешно загружен.');
                    window.location.reload();  // Обновляем страницу после загрузки
                } else {
                    alert('Ошибка при загрузке документа.');
                }
            })
            .catch(error => {
                console.error('Ошибка:', error);
                alert('Ошибка при загрузке документа.');
            });
        } else {
            alert('Пожалуйста, выберите PDF-файл.');
        }
    });
        
        // Функции для работы с модальным окном удаления
        function confirmDelete(docName) {
            document.getElementById('documentNameToDelete').textContent = docName;
            document.getElementById('deleteModal').style.display = 'flex';
        }

        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
        }

        async function deleteDocument() {
            const docName = document.getElementById('documentNameToDelete').textContent;
            const response = await fetch(`/delete?doc_name=${docName}`, {
                method: 'DELETE',
            });

            if (response.ok) {
                alert(`Документ "${docName}" успешно удалён.`);
                window.location.reload();
            } else {
                alert("Ошибка при удалении документа.");
            }
        }

        // Поиск документов
        document.getElementById('searchQuery').addEventListener('input', function(event) {
            const query = event.target.value.toLowerCase();
            const documentCards = document.querySelectorAll('.document-card');

            documentCards.forEach(card => {
                const docName = card.querySelector('.doc-info h3').textContent.toLowerCase();
                if (docName.includes(query)) {
                    card.style.display = 'flex';  // Показываем документ, если он соответствует запросу
                } else {
                    card.style.display = 'none';  // Скрываем документ, если он не соответствует запросу
                }
            });
        });
    </script>
{% endblock %}