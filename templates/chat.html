{% extends "base.html" %}

{% block title %} AAAA | –ß–∞—Ç-–±–æ—Ç{% endblock %}

{% block content %}
    <div class="chat-page">
        <div class="page-header">
            <h1>–ß–∞—Ç-–±–æ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç</h1>
        </div>

        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <!-- –°–æ–æ–±—â–µ–Ω–∏—è —á–∞—Ç–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
            </div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö...">
                <button id="sendMessageBtn">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="22" y1="2" x2="11" y2="13"></line>
                        <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                    </svg>
                </button>
            </div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
        function addMessage(sender, text) {
            const chatMessages = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender === 'bot' ? 'bot-message' : 'user-message'}`;

            messageDiv.innerHTML = `
                <div class="message-avatar">
                    ${sender === 'bot' ? 'ü§ñ' : 'üë§'}
                </div>
                <div class="message-content">
                    <div class="message-text">${text}</div>
                </div>
            `;

            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;  // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
        }

        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
        document.getElementById('sendMessageBtn').addEventListener('click', async () => {
            const chatInput = document.getElementById('chatInput');
            const message = chatInput.value.trim();

            if (message) {
                addMessage('user', message);  // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                chatInput.value = '';  // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞

                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä
                const response = await fetch('/send_message', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message }),
                });

                if (response.ok) {
                    const data = await response.json();
                    addMessage('bot', data.message);  // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –±–æ—Ç–∞
                } else {
                    alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è.');
                }
            }
        });

        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter
        document.getElementById('chatInput').addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                document.getElementById('sendMessageBtn').click();
            }
        });
    </script>
{% endblock %}